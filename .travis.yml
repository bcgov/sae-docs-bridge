os: linux
dist: trusty
sudo: required
language: node_js
services:
- docker
jobs:
  include:
  - name: SAE Docs Bridge API
    stage: APIs
    language: node_js
    node_js: lts/*
    cache: npm
    before_install:
    - |-
      cd /home/travis/build/bcgov/sae-docs-bridge
      npm ci
      if [ "$TRAVIS_TAG" = "" ]; then npm audit --production; fi
    before_script:
    - |-
      cd /home/travis/build/bcgov/sae-docs-bridge
      cp config/default.json.template config/default.json
    script:
    - |-
      cd /home/travis/build/bcgov/sae-docs-bridge
      npm test
      bash docker_quayio_push sae_docs_bridge
    before_deploy:
    - cd /home/travis/build/bcgov/sae-docs-bridge
    deploy:
      provider: script
      script: bash docker_push sae_docs_bridge || travis_terminate 1
      on:
        all_branches: true
        condition: "$TRAVIS_BRANCH =~ ^master|develop$ || -n $TRAVIS_TAG"
env:
  global:
  - DOCKER_USERNAME=h3brandon
  - QUAYIO_USERNAME=h3brandon
  - secure: cpCf/Hb73w++5thsl5PBN4ixHqmHS9UywkK/RXRYJxp9d3l2sgcibhNXSq8DvwSw0B+Sdn0R7A73/eVaoqDAlvb8r6cTt6cqW98xA3vLfhTNios5GUTFMBciG5V7mIfyKWTEBQz4LDmV/SeDaYLRNSKUAPPDYgjznfqmvaeErD84lTy7aR3FTBaGYmNLLELresUMy+v0FmSr/0KtQcr1LYnibNg4cXKQUuM7c/E3seW44rDx1PQrCvDNWmHfeG+/F6u5ifo9LgBjTFX3QnkOdSFqPNQONemTtg9x+XnzZvTbkguRJ7ChsT+PWDwMjry96Bg5bBFxBu1oxp+ErJCXii4iqjN7dy0uHVss9cg5VrgM6aj5yuc21dxDf48800H4auhUxc+cyujHm+5URUCuIVI8A3hM9vnRngmfjZ6e7KGKwR0vZYceMCyhN/mZlmSqZxHlODu6lFC8BlaGUx5S9b6gJC8xMxxVise+HBtHGJlNgwlFNuWYg/7PntxPoEwGqRRsgzWiFQ8RfglWMuT/f1sjTcqVF1MOk2dkzx+ai970Tobk9QwbMRIRzAWFpaeUS0Mq43kRs/W0E5fF1zFwCBvWYgF4Orz++W+gwb6dYy3jx6EwhmPjLz8Ew+vJ+WoCLQDWRddL8wxF5q+SJSNSnp0Cgr4m8IPwLHGTiiDSVlg=
  - secure: mSukY7wncKef+l8mPk2qvWDD5mwXLi9zp+JUnPFg2Wj7ipSlWg3GHO/vsIhlpqWyNzwPW9Hcqz54OYVOPgrOmEuINWoDYjeV6b0/YTL9lA7GJ7mCky/xSC2Z0Bw16wGRocBUUwsO04VqMZBz1oBFBiluTEivrOJG58eCJpWGbzqM7RVRptFox5qXEz/YYpVxyYJAU6uqi8IAlHuDK0vfzNPuUnFYSgeCBMmLQDHNtICh27BfNgg579QaJFaoA6yfyMOZ4lUvpltcTRa9ZH9558m9vz2z2XIILn60kvur0A4bkBJ7WpWQF6XYZ/SKEPqHLWiqTDovnwk3vR5slIysvOMOZaj1Vhgmd//eDLUp4Sqx4fCErmjmZEcBnztJdBN0omM0uTi8tctQGhSH/7LEzAJPFGkU68N74ddZbMQnYvXUn+ALmHQwmI5PXPJ7GHczeQrMXz2/iogpkzWGYjnXpEWbt41eBgpoNX5FEa2++g6vxSx9iYz9wjNnaOkjTJF1kskbuyQamKXO9p9WToXMdeErczNsrLHxgZ+UJO764NPrr7/omDCdPwz5aeprbwmIhHLSfYKwZE3eS9fKbdntWc/M11hWVeAik/do97Cl7o8LjlEVNlIvSz8HckVt4EDQ38iVjrl+4hkooZS/jynw69GWgVWseMCA1VCyTjW4Mp0=
